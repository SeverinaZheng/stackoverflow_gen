# Docker File for LDBC-SNB Data Generator

Suppose you want to generate synthetic graph data compaible and loadable into a [Tinkerpop 3 data format](http://tinkerpop.apache.org/docs/current/reference/#_gremlin_i_o).
We are here to the rescue!
This repo contains files and configurations that build a docker image with the desirde data inside, and then how to transpose it to the Tinkerpop-compatible format, and how to load it into Tinkergraph.

Below a preamble, the *“just run it!”* steps are in the section **RUN!**, but you should still read below to know what will happen. 

## [LDBC-SNB Data Generator](https://github.com/ldbc/ldbc_snb_datagen)

The LDBC-SNB Data Generator (DATAGEN) is the responsible of providing the data sets used by all the LDBC benchmarks.
This data generator is designed to produce directed labeled graphs that mimic the characteristics of those graphs of real data.
A detailed description of the schema produced by datagen, as well as the format of the output files, can be found in the latest version of official [LDBC SNB specification document](https://github.com/ldbc/ldbc_snb_docs)

**Actually** what you care about is described as a [list of csv files](https://github.com/ldbc/ldbc_snb_datagen/wiki/Generated-CSV-Files).

## The generation process

To obtain such data one should: install hadoop, configure it, download gremlin, download `ldbc_gen` code, configure it, and then run it.
Detailed steps are in the `Dockerfile`, sample configuration is in th `extra` directory.

After gnerating the `.csv` files with hadoop (they may be huge, they may require a lot of RAM to be done) the next step is to parse each one of them, and import their content into nodes and/or edges.
This second part is carried out by a gremlin/groovy script based upon the work of [Jonathan Ellithorpe (ellitron) at PlatformLab](https://github.com/PlatformLab/ldbc-snb-impls/blob/master/snb-interactive-titan/src/main/java/net/ellitron/ldbcsnbimpls/interactive/titan/TitanGraphLoader.java).

## Configure

Standard configuration is for a ver small dataset, with 100 users and 1 year of activiy (see `images/extra/ldbc.params.ini`)

~~~~bash
#...

ldbc.snb.datagen.generator.numPersons:100
ldbc.snb.datagen.generator.numYears:1

#...
~~~~





## RUN!

The *zero step* is having docker up and running with all the required permissions for the current user.
Then build the image in `images` with:

~~~bash
cd images
docker build -t gremlin/ldbc_gen -f gremlin-ldbc_gen.dockerfile .
~~~

This will do all the steps above, among which running hadoop and generating the data.
Then the image can be used a first time to generate the Tinkerpop-compatible datasets with the following

~~~bash
docker run  -v `pwd`/runtime:/runtime -e JAVA_OPTIONS='-Xms1G -Xmn128M -Xmx32G' gremlin/ldbc_gen
~~~

The data Data is exported in two different formats to the directory `./runtime/data` which will be generated by the `runtime/ldbc.groovy` script.

The third step, is to run it in interactive mode running the gremlin console.


~~~bash
docker run  -it -v `pwd`/runtime:/runtime -e JAVA_OPTIONS='-Xms1G -Xmn128M -Xmx32G' gremlin/ldbc_gen gremlin.sh
~~~


